!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-selection"),require("d3-transition"),require("d3-array")):"function"==typeof define&&define.amd?define("d3plus-text",["exports","d3-selection","d3-transition","d3-array"],n):n(t.d3plus_text={},t.d3_selection,t.d3_transition,t.d3_array)}(this,function(t,n,e,i){"use strict";function r(t){return function(){return t}}function o(t){var e=arguments.length<=1||void 0===arguments[1]?{"font-size":10,"font-family":"sans-serif"}:arguments[1],i=n.select("body").selectAll("canvas#d3plus-text-size").data([0]);i.enter().append("canvas").attr("id","d3plus-text-size").style("position","absolute").style("left","-9999px").style("top","-9999px").style("visibility","hidden").style("display","block");var r=i.node().getContext("2d"),o=[];if("font-style"in e&&o.push(e["font-style"]),"font-variant"in e&&o.push(e["font-variant"]),"font-weight"in e&&o.push(e["font-weight"]),"font-size"in e){var u=e["font-size"]+"px";"line-height"in e&&(u+="/"+e["line-height"]+"px"),o.push(u)}return"font-family"in e&&o.push(e["font-family"]),r.font=o.join(" "),t instanceof Array?t.map(function(t){return r.measureText(t).width}):r.measureText(t).width}function u(t){return t.height||200}function a(t,n){return t.id||""+n}function f(t){return t.match(m)}function s(t){return t.text}function l(t){return t.width||200}function c(t){return t.x||0}function d(t){return t.y||0}function h(){function t(t){return t+"..."}function n(){void 0===q&&n.select(p.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").node());var t=q.selectAll(".d3plus-text-box").data(e,A);return t.enter().append("text").attr("class","d3plus-text-box").attr("id",function(t,n){return"d3plus-text-box-"+A(t,n)}),t.attr("y",function(t,n){return H(t,n)+"px"}).attr("fill",function(t,n){return y(t,n)}).attr("text-anchor",function(t,n){return k(t,n)}).attr("font-family",function(t,n){return m(t,n)}).each(function(t,n){function e(){if(s=1,l=[""],y>a)return void(l=[]);a>d&&(a=d);var t="",n=0;u&&(f=1.1*a,G["font-size"]=a,G["line-height"]=f),c=o(B,G);var i=!0,r=!1,h=void 0;try{for(var p,m=B[Symbol.iterator]();!(i=(p=m.next()).done);i=!0){var x=p.value,v=T.charAt(t.length+x.length),b=c[B.indexOf(x)];if(" "===v&&(x+=v),n+b>W-a){if(s++,f*s>A||b>W&&!q){if(u){if(a--,y>a){l=[];break}e()}else l[s-2]=g(l[s-2].trimRight());break}n=0,l.push(x)}else l[s-1]+=x;t+=x,n+=b," "===v&&(n+=H)}}catch(w){r=!0,h=w}finally{try{!i&&m["return"]&&m["return"]()}finally{if(r)throw h}}}function r(e){e.text(function(t){return t.trimRight()}).attr("x",S(t,n)+"px").attr("dx",D+"px").attr("dy",f+"px")}var u=b(t,n),a=u?x(t,n):w(t,n),f=u?1.1*a:M(t,n),s=1,l=[""],c=void 0,d=x(t,n),y=v(t,n),A=z(t,n),q=j(t,n),H=o(" ",G),T=_(t,n),E=k(t,n),O=C(t,n),W=F(t,n),B=R(T,n),D="start"===E?0:"end"===E?W:W/2,G={"font-family":m(t,n),"font-size":a,"line-height":f};if(A>f||u){if(u){c=o(B,G);var I=1.165+W/A*.1,J=W*A,K=p.max(c),L=p.sum(c,function(t){return t*f})*I;if(K>W||L>J){var N=Math.sqrt(J/L),P=W/K,Q=p.min([N,P]);a=Math.floor(a*Q)}var U=Math.floor(.8*A);a>U&&(a=U)}e(),p.select(this).attr("font-size",a+"px").style("font-size",a+"px")}var V=s*f,X="top"===O?0:"middle"===O?A/2-V/2:A-V;X-=.2*f,p.select(this).transition().duration(h).attr("transform","translate(0,"+X+")");var Y=p.select(this).selectAll("tspan").data(l);Y.exit().transition().duration(h).attr("opacity",0).remove(),Y.transition().duration(h).call(r),Y.enter().append("tspan").attr("dominant-baseline","alphabetic").style("baseline-shift","0%").attr("opacity",0).call(r).transition().duration(h).delay(i).attr("opacity",1)}),n}var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],i=0,h=0,g=t,y=void 0,m=void 0,x=r(50),v=r(8),b=r(!1),w=void 0,z=u,A=a,M=void 0,j=r(!1),q=void 0,R=f,_=s,k=r("start"),C=r("top"),F=l,S=c,H=d;return n.data=function(t){return arguments.length?(e=t,n):e},n.delay=function(t){return arguments.length?(i=t,n):i},n.duration=function(t){return arguments.length?(h=t,n):h},n.ellipsis=function(t){return arguments.length?(g="function"==typeof t?t:r(t),n):g},n.fontColor=function(t){return arguments.length?(y="function"==typeof t?t:r(t),n):y},n.fontFamily=function(t){return arguments.length?(m="function"==typeof t?t:r(t),n):m},n.fontMax=function(t){return arguments.length?(x="function"==typeof t?t:r(t),n):x},n.fontMin=function(t){return arguments.length?(v="function"==typeof t?t:r(t),n):v},n.fontResize=function(t){return arguments.length?(b="function"==typeof t?t:r(t),n):b},n.fontSize=function(t){return arguments.length?(w="function"==typeof t?t:r(t),void 0===M&&(M=r(Math.ceil(1.1*w()))),n):w},n.height=function(t){return arguments.length?(z="function"==typeof t?t:r(t),n):z},n.id=function(t){return arguments.length?(A="function"==typeof t?t:r(t),n):A},n.lineHeight=function(t){return arguments.length?(M="function"==typeof t?t:r(t),n):M},n.overflow=function(t){return arguments.length?(j="function"==typeof t?t:r(t),n):j},n.select=function(t){return arguments.length?(q=p.select(t),void 0===y&&n.fontColor(q.style("font-color")),void 0===m&&n.fontFamily(q.style("font-family")),void 0===w&&n.fontSize(parseFloat(q.style("font-size"),10)),n):q},n.split=function(t){return arguments.length?(R=t,n):R},n.text=function(t){return arguments.length?(_="function"==typeof t?t:r(t),n):_},n.textAnchor=function(t){return arguments.length?(k="function"==typeof t?t:r(t),n):k},n.verticalAlign=function(t){return arguments.length?(C="function"==typeof t?t:r(t),n):C},n.width=function(t){return arguments.length?(F="function"==typeof t?t:r(t),n):F},n.x=function(t){return arguments.length?(S="function"==typeof t?t:r(t),n):S},n.y=function(t){return arguments.length?(H="function"==typeof t?t:r(t),n):H},e.length?n():n}var g="0.4.0",p={max:i.max,min:i.min,select:n.select,sum:i.sum,transition:e.transition},y=["-","/",";",":","&"],m=new RegExp("[^\\s\\"+y.join("\\")+"]+\\"+y.join("?\\")+"?","g");t.version=g,t.box=h,t.width=o});